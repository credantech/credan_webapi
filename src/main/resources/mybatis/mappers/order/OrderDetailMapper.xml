<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.credan.webapi.core.dao.mapper.order.OrderDetailDao">
	<resultMap id="BaseResultMap" type="com.credan.webapi.core.dao.entity.order.OrderDetail">
		<!-- WARNING - @mbg.generated This element is automatically generated by MyBatis Generator, do not 
			modify. This element was generated on Wed Nov 02 17:31:16 CST 2016. -->
		<id column="id" jdbcType="VARCHAR" property="id" />
		<result column="merchant_id" jdbcType="VARCHAR" property="merchantId" />
		<result column="order_id" jdbcType="VARCHAR" property="orderId" />
		<result column="project_id" jdbcType="VARCHAR" property="projectId" />
		<result column="name" jdbcType="VARCHAR" property="name" />
		<result column="type" jdbcType="VARCHAR" property="type" />
		<result column="price" jdbcType="DECIMAL" property="price" />
		<result column="order_amount" jdbcType="DECIMAL" property="orderAmount" />
		<result column="term" jdbcType="BIGINT" property="term" />
		<result column="unit" jdbcType="CHAR" property="unit" />
		<result column="count" jdbcType="BIGINT" property="count" />
		<result column="remarks" jdbcType="VARCHAR" property="remarks" />
		<result column="call_back_time" jdbcType="TIMESTAMP" property="callBackTime" />
		<result column="next_call_back_time" jdbcType="TIMESTAMP" property="nextCallBackTime" />
		<result column="call_back_count" jdbcType="BIGINT" property="callBackCount" />
		<result column="call_back_result" jdbcType="VARCHAR" property="callBackResult" />
		<result column="ext" jdbcType="VARCHAR" property="ext" />
		<result column="version" jdbcType="BIGINT" property="version" />
		<result column="memo" jdbcType="VARCHAR" property="memo" />
		<result column="del_flag" jdbcType="CHAR" property="delFlag" />
		<result column="created_time" jdbcType="TIMESTAMP" property="createdTime" />
		<result column="last_updated" jdbcType="TIMESTAMP" property="lastUpdated" />
	</resultMap>
	<sql id="Base_Column_List">
		<!-- WARNING - @mbg.generated This element is automatically generated by MyBatis Generator, do not 
			modify. This element was generated on Wed Nov 02 17:31:16 CST 2016. -->
		id, merchant_id, order_id, project_id, name, type, price, order_amount, term, unit,
		count, remarks,
		call_back_time, next_call_back_time, call_back_count, call_back_result, ext, version, memo,
		del_flag, created_time,
		last_updated
	</sql>
	<select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
		<!-- WARNING - @mbg.generated This element is automatically generated by MyBatis Generator, do not 
			modify. This element was generated on Wed Nov 02 17:31:16 CST 2016. -->
		select
		<include refid="Base_Column_List" />
		from merchant_order_detail
		where id = #{id,jdbcType=VARCHAR}
	</select>
	<delete id="deleteByPrimaryKey" parameterType="java.lang.String">
		<!-- WARNING - @mbg.generated This element is automatically generated by MyBatis Generator, do not 
			modify. This element was generated on Wed Nov 02 17:31:16 CST 2016. -->
		delete from merchant_order_detail
		where id = #{id,jdbcType=VARCHAR}
	</delete>
	<insert id="insert" parameterType="com.credan.webapi.core.dao.entity.order.OrderDetail">
		<!-- WARNING - @mbg.generated This element is automatically generated by MyBatis Generator, do not 
			modify. This element was generated on Wed Nov 02 17:31:16 CST 2016. -->
		insert into merchant_order_detail (id, merchant_id, order_id,
		project_id, name, type,
		price,
		order_amount, term,
		unit, count, remarks, call_back_time,next_call_back_time,
		call_back_count, call_back_result, ext,
		version, memo, del_flag,
		created_time, last_updated)
		values (#{id,jdbcType=VARCHAR},
		#{merchantId,jdbcType=VARCHAR}, #{orderId,jdbcType=VARCHAR},
		#{projectId,jdbcType=VARCHAR},
		#{name,jdbcType=VARCHAR}, #{type,jdbcType=VARCHAR},
		#{price,jdbcType=DECIMAL},
		#{orderAmount,jdbcType=DECIMAL}, #{term,jdbcType=BIGINT},
		#{unit,jdbcType=CHAR},
		#{count,jdbcType=BIGINT}, #{remarks,jdbcType=VARCHAR},
		#{callBackTime,jdbcType=TIMESTAMP},
		#{nextCallBackTime,jdbcType=TIMESTAMP},
		#{callBackCount,jdbcType=BIGINT}, #{callBackResult,jdbcType=VARCHAR}, #{ext,jdbcType=VARCHAR},
		#{version,jdbcType=BIGINT}, #{memo,jdbcType=VARCHAR}, #{delFlag,jdbcType=CHAR},
		#{createdTime,jdbcType=TIMESTAMP}, #{lastUpdated,jdbcType=TIMESTAMP})
	</insert>
	<insert id="insertSelective" parameterType="com.credan.webapi.core.dao.entity.order.OrderDetail">
		<!-- WARNING - @mbg.generated This element is automatically generated by MyBatis Generator, do not 
			modify. This element was generated on Wed Nov 02 17:31:16 CST 2016. -->
		insert into merchant_order_detail
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null">
				id,
			</if>
			<if test="merchantId != null">
				merchant_id,
			</if>
			<if test="orderId != null">
				order_id,
			</if>
			<if test="projectId != null">
				project_id,
			</if>
			<if test="name != null">
				name,
			</if>
			<if test="type != null">
				type,
			</if>
			<if test="price != null">
				price,
			</if>
			<if test="orderAmount != null">
				order_amount,
			</if>
			<if test="term != null">
				term,
			</if>
			<if test="unit != null">
				unit,
			</if>
			<if test="count != null">
				count,
			</if>
			<if test="remarks != null">
				remarks,
			</if>
			<if test="callBackTime != null">
				call_back_time,
			</if>
			<if test="next_call_back_time != null">
				next_call_back_time,
			</if>
			<if test="callBackCount != null">
				call_back_count,
			</if>
			<if test="callBackResult != null">
				call_back_result,
			</if>
			<if test="ext != null">
				ext,
			</if>
			<if test="version != null">
				version,
			</if>
			<if test="memo != null">
				memo,
			</if>
			<if test="delFlag != null">
				del_flag,
			</if>
			<if test="createdTime != null">
				created_time,
			</if>
			<if test="lastUpdated != null">
				last_updated,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="id != null">
				#{id,jdbcType=VARCHAR},
			</if>
			<if test="merchantId != null">
				#{merchantId,jdbcType=VARCHAR},
			</if>
			<if test="orderId != null">
				#{orderId,jdbcType=VARCHAR},
			</if>
			<if test="projectId != null">
				#{projectId,jdbcType=VARCHAR},
			</if>
			<if test="name != null">
				#{name,jdbcType=VARCHAR},
			</if>
			<if test="type != null">
				#{type,jdbcType=VARCHAR},
			</if>
			<if test="price != null">
				#{price,jdbcType=DECIMAL},
			</if>
			<if test="orderAmount != null">
				#{orderAmount,jdbcType=DECIMAL},
			</if>
			<if test="term != null">
				#{term,jdbcType=BIGINT},
			</if>
			<if test="unit != null">
				#{unit,jdbcType=CHAR},
			</if>
			<if test="count != null">
				#{count,jdbcType=BIGINT},
			</if>
			<if test="remarks != null">
				#{remarks,jdbcType=VARCHAR},
			</if>
			<if test="callBackTime != null">
				#{callBackTime,jdbcType=TIMESTAMP},
			</if>
			<if test="nextCallBackTime != null">
				#{nextCallBackTime,jdbcType=TIMESTAMP},
			</if>
			<if test="callBackCount != null">
				#{callBackCount,jdbcType=BIGINT},
			</if>
			<if test="callBackResult != null">
				#{callBackResult,jdbcType=VARCHAR},
			</if>
			<if test="ext != null">
				#{ext,jdbcType=VARCHAR},
			</if>
			<if test="version != null">
				#{version,jdbcType=BIGINT},
			</if>
			<if test="memo != null">
				#{memo,jdbcType=VARCHAR},
			</if>
			<if test="delFlag != null">
				#{delFlag,jdbcType=CHAR},
			</if>
			<if test="createdTime != null">
				#{createdTime,jdbcType=TIMESTAMP},
			</if>
			<if test="lastUpdated != null">
				#{lastUpdated,jdbcType=TIMESTAMP},
			</if>
		</trim>
	</insert>
	<update id="updateByPrimaryKeySelective" parameterType="com.credan.webapi.core.dao.entity.order.OrderDetail">
		<!-- WARNING - @mbg.generated This element is automatically generated by MyBatis Generator, do not 
			modify. This element was generated on Wed Nov 02 17:31:16 CST 2016. -->
		update merchant_order_detail
		<set>
			<if test="merchantId != null">
				merchant_id = #{merchantId,jdbcType=VARCHAR},
			</if>
			<if test="orderId != null">
				order_id = #{orderId,jdbcType=VARCHAR},
			</if>
			<if test="projectId != null">
				project_id = #{projectId,jdbcType=VARCHAR},
			</if>
			<if test="name != null">
				name = #{name,jdbcType=VARCHAR},
			</if>
			<if test="type != null">
				type = #{type,jdbcType=VARCHAR},
			</if>
			<if test="price != null">
				price = #{price,jdbcType=DECIMAL},
			</if>
			<if test="orderAmount != null">
				order_amount = #{orderAmount,jdbcType=DECIMAL},
			</if>
			<if test="term != null">
				term = #{term,jdbcType=BIGINT},
			</if>
			<if test="unit != null">
				unit = #{unit,jdbcType=CHAR},
			</if>
			<if test="count != null">
				count = #{count,jdbcType=BIGINT},
			</if>
			<if test="remarks != null">
				remarks = #{remarks,jdbcType=VARCHAR},
			</if>
			<if test="callBackTime != null">
				call_back_time = #{callBackTime,jdbcType=TIMESTAMP},
			</if>
			<if test="nextCallBackTime != null">
				next_call_back_time = #{nextCallBackTime,jdbcType=TIMESTAMP},
			</if>
			<if test="callBackCount != null">
				call_back_count = #{callBackCount,jdbcType=BIGINT},
			</if>
			<if test="callBackResult != null">
				call_back_result = #{callBackResult,jdbcType=VARCHAR},
			</if>
			<if test="ext != null">
				ext = #{ext,jdbcType=VARCHAR},
			</if>
			<if test="version != null">
				version = #{version,jdbcType=BIGINT},
			</if>
			<if test="memo != null">
				memo = #{memo,jdbcType=VARCHAR},
			</if>
			<if test="delFlag != null">
				del_flag = #{delFlag,jdbcType=CHAR},
			</if>
			<if test="createdTime != null">
				created_time = #{createdTime,jdbcType=TIMESTAMP},
			</if>
			<if test="lastUpdated != null">
				last_updated = #{lastUpdated,jdbcType=TIMESTAMP},
			</if>
		</set>
		where id = #{id,jdbcType=VARCHAR}
	</update>
	<update id="updateByPrimaryKey" parameterType="com.credan.webapi.core.dao.entity.order.OrderDetail">
		<!-- WARNING - @mbg.generated This element is automatically generated by MyBatis Generator, do not 
			modify. This element was generated on Wed Nov 02 17:31:16 CST 2016. -->
		update merchant_order_detail
		set merchant_id = #{merchantId,jdbcType=VARCHAR},
		order_id =
		#{orderId,jdbcType=VARCHAR},
		project_id = #{projectId,jdbcType=VARCHAR},
		name =
		#{name,jdbcType=VARCHAR},
		type = #{type,jdbcType=VARCHAR},
		price = #{price,jdbcType=DECIMAL},
		order_amount = #{orderAmount,jdbcType=DECIMAL},
		term = #{term,jdbcType=BIGINT},
		unit =
		#{unit,jdbcType=CHAR},
		count = #{count,jdbcType=BIGINT},
		remarks = #{remarks,jdbcType=VARCHAR},
		call_back_time = #{callBackTime,jdbcType=TIMESTAMP},
		next_call_back_time = #{nextCallBackTime,jdbcType=TIMESTAMP},
		call_back_count =
		#{callBackCount,jdbcType=BIGINT},
		call_back_result = #{callBackResult,jdbcType=VARCHAR},
		ext =
		#{ext,jdbcType=VARCHAR},
		version = #{version,jdbcType=BIGINT},
		memo = #{memo,jdbcType=VARCHAR},
		del_flag = #{delFlag,jdbcType=CHAR},
		created_time = #{createdTime,jdbcType=TIMESTAMP},
		last_updated
		= #{lastUpdated,jdbcType=TIMESTAMP}
		where id = #{id,jdbcType=VARCHAR}
	</update>

	<select id="findOneByOrderId" parameterType="java.lang.String" resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		from merchant_order_detail
		where order_id = #{orderId,jdbcType=VARCHAR}
	</select>
	<select id="findOneByProjectId" parameterType="java.lang.String" resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		from merchant_order_detail
		where project_id = #{projectId,jdbcType=VARCHAR}
	</select>

	<!-- 查询订单明细  -->
	<select id="findDetails" resultType="com.credan.webapi.core.dao.entity.order.OrderDetailVo">
		SELECT d.order_id as "orderId",d.created_time as
		"applyDate", p.user_id as "userId",
		d.order_amount as "loanAmt",p.term as "loanTnr",
		p.monthly_fee as "loanMonthRate", (SELECT dict_name from sys_dictionary where dict_type in
		('ci_product_audit_status','ci_project_repay_status') and dict_code =
		IFNULL(p.status,p.audit_status)) as "statusDesc", IFNULL(p.status,p.audit_status) as "status"
		from merchant_order_detail d LEFT JOIN
		ci_installment_project p on d.project_id = p.id 
		where d.order_id in
		<foreach collection="list" item="item" open="(" close=")" separator=",">
			#{item}
		</foreach>
	</select>
	
	<!-- 查询job通知状态变更的数据 -->
	<select id="findList4Job" resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		from merchant_order_detail
		where next_call_back_time > 0  ORDER BY next_call_back_time asc limit 100
	</select>

</mapper>